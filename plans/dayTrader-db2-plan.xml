<?xml version="1.0" encoding="UTF-8"?>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<!-- $Rev: 555467 $ $Date: 2007-07-11 22:39:14 -0400 (Wed, 11 Jul 2007) $ -->

<application xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-1.2">
    <environment>
        <moduleId>
            <groupId>org.apache.geronimo.daytrader</groupId>
            <artifactId>daytrader</artifactId>
            <version>2.0-SNAPSHOT</version>
            <type>car</type>
        </moduleId>
        <!--
         **
         ** The following section describes what other modules this application has dependencies on.  Since we will be 
         ** accessing our tables using the internal Derby database we need the system-database dependency.  Also, JPA is 
         ** used as a persistence mechanism so we have a dependency on the openjpa module as well.  
         **
         ** The dependency on Yoko is required but should be supplied by default.  This is just silly.
        -->
        <dependencies>
            <dependency>
                <groupId>org.apache.geronimo.configs</groupId>
                <artifactId>openjpa</artifactId>
                <type>car</type>
            </dependency>
            <dependency>
                <groupId>org.apache.geronimo.configs</groupId>
                <artifactId>j2ee-corba-yoko</artifactId>
                <type>car</type>
            </dependency>
            <dependency>
                <groupId>com.ibm.db2</groupId>
                <artifactId>db2jcc</artifactId>
                <version>8.2</version>
                <type>jar</type>
            </dependency>
            <dependency>
                <groupId>com.ibm.db2</groupId>
                <artifactId>db2jcc_license_cu</artifactId>
                <version>8.2</version>
                <type>jar</type>
            </dependency>
        </dependencies>
    </environment>

    <module>
        <web>web.war</web>
        <web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-1.2">
            <service-ref>
                <service-ref-name>service/Trade</service-ref-name>
                <port>
                    <port-name>TradeWSServices</port-name>
                    <protocol>http</protocol>
                    <host>localhost</host>
                    <port>8080</port>
                    <uri>/daytrader/services/TradeWSServices</uri>
                </port>
            </service-ref>
        </web-app>
    </module>


    <!--
    ##
    ##  T r a d e E J B . j a r
    ##  Module Definition
    ##
    ##
    -->
    <module>
        <ejb>dt-ejb.jar</ejb>
        <!--  Note this must match the -->
        <openejb-jar xmlns="http://openejb.apache.org/xml/ns/openejb-jar-2.2">


            <!--
            ##
            ##  C o n n e c t i o n  F a c t o r y  D e f i n i t i o n
            ##
            ##
            ##
            -->
            <cmp-connection-factory>
                <resource-link>jdbc/TradeDataSource</resource-link>
            </cmp-connection-factory>

            <enterprise-beans>
                <session>
                    <ejb-name>TradeEJB</ejb-name>
                    <jndi-name>ejb/TradeEJB</jndi-name>
                    <!-- resource-env-ref>
                        <ref-name>jms/TradeBrokerQueue</ref-name>
                        <message-destination-link>jms/TradeBrokerQueue</message-destination-link>
                    </resource-env-ref -->
                </session>
                
                <session>
                    <ejb-name>TradeJPA</ejb-name>
                    <persistence-context-ref>
                        <persistence-context-ref-name>daytrader</persistence-context-ref-name>
                        <persistence-unit-name>daytrader</persistence-unit-name>
                        <persistence-context-type>Transactional</persistence-context-type>
                    </persistence-context-ref>
                </session>
                
                <session>
                    <ejb-name>KeySequenceEJB</ejb-name>
                    <jndi-name>ejb/KeySequenceEJB</jndi-name>
                    <cache-size>100</cache-size>
                </session>


                <!--
                ##
                ##  H o l d i n g E J B
                ##
                -->
                <entity>
                    <ejb-name>HoldingEJB</ejb-name>
                    <table-name>HOLDINGEJB</table-name>
                    <cmp-field-mapping>
                        <cmp-field-name>purchasePrice</cmp-field-name>
                        <table-column>purchasePrice</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>holdingID</cmp-field-name>
                        <table-column>holdingID</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>quantity</cmp-field-name>
                        <table-column>quantity</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>purchaseDate</cmp-field-name>
                        <table-column>purchaseDate</table-column>
                    </cmp-field-mapping>
                </entity>


                <!--
                ##
                ##  A c c o u n t P r o f i l e E J B
                ##
                -->
                <entity>
                    <ejb-name>AccountProfileEJB</ejb-name>
                    <table-name>AccountProfileEJB</table-name>
                    <cmp-field-mapping>
                        <cmp-field-name>address</cmp-field-name>
                        <table-column>address</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>passwd</cmp-field-name>
                        <table-column>passwd</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>userID</cmp-field-name>
                        <table-column>userID</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>email</cmp-field-name>
                        <table-column>email</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>creditCard</cmp-field-name>
                        <table-column>creditCard</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>fullName</cmp-field-name>
                        <table-column>fullName</table-column>
                    </cmp-field-mapping>
                </entity>


                <!--
                ##
                ##  Q u o t e E J B
                ##
                -->
                <entity>
                    <ejb-name>QuoteEJB</ejb-name>
                    <table-name>QuoteEJB</table-name>
                    <cmp-field-mapping>
                        <cmp-field-name>low</cmp-field-name>
                        <table-column>low</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>open</cmp-field-name>
                        <table-column>open1</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>volume</cmp-field-name>
                        <table-column>volume</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>price</cmp-field-name>
                        <table-column>price</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>high</cmp-field-name>
                        <table-column>high</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>companyName</cmp-field-name>
                        <table-column>companyName</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>symbol</cmp-field-name>
                        <table-column>symbol</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>change</cmp-field-name>
                        <table-column>change1</table-column>
                    </cmp-field-mapping>
                </entity>


                <!--
                ##
                ##  K e y G e n E J B
                ##
                -->
                <entity>
                    <ejb-name>KeyGenEJB</ejb-name>
                    <table-name>KeyGenEJB</table-name>
                    <cmp-field-mapping>
                        <cmp-field-name>keyVal</cmp-field-name>
                        <table-column>keyVal</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>keyName</cmp-field-name>
                        <table-column>keyName</table-column>
                    </cmp-field-mapping>
                </entity>


                <!--
                ##
                ##  A c c o u n t E J B
                ##
                -->
                <entity>
                    <ejb-name>AccountEJB</ejb-name>
                    <table-name>AccountEJB</table-name>
                    <cmp-field-mapping>
                        <cmp-field-name>creationDate</cmp-field-name>
                        <table-column>creationDate</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>openBalance</cmp-field-name>
                        <table-column>openBalance</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>logoutCount</cmp-field-name>
                        <table-column>logoutCount</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>balance</cmp-field-name>
                        <table-column>balance</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>accountID</cmp-field-name>
                        <table-column>accountID</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>lastLogin</cmp-field-name>
                        <table-column>lastLogin</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>loginCount</cmp-field-name>
                        <table-column>loginCount</table-column>
                    </cmp-field-mapping>
                </entity>


                <!--
                ##
                ##  O r d e r E J B
                ##
                -->
                <entity>
                    <ejb-name>OrderEJB</ejb-name>
                    <table-name>OrderEJB</table-name>
                    <cmp-field-mapping>
                        <cmp-field-name>orderFee</cmp-field-name>
                        <table-column>orderFee</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>completionDate</cmp-field-name>
                        <table-column>completionDate</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>orderType</cmp-field-name>
                        <table-column>orderType</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>orderStatus</cmp-field-name>
                        <table-column>orderStatus</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>price</cmp-field-name>
                        <table-column>price</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>quantity</cmp-field-name>
                        <table-column>quantity</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>openDate</cmp-field-name>
                        <table-column>openDate</table-column>
                    </cmp-field-mapping>
                    <cmp-field-mapping>
                        <cmp-field-name>orderID</cmp-field-name>
                        <table-column>orderID</table-column>
                    </cmp-field-mapping>
                </entity>


                <message-driven>
                    <ejb-name>TradeStreamerMDB</ejb-name>
                    <resource-adapter>
                        <resource-link>TradeJMSResources</resource-link>
                    </resource-adapter>
                    <activation-config>
                        <activation-config-property>
                            <activation-config-property-name>destinationType</activation-config-property-name>
                            <activation-config-property-value>javax.jms.Queue</activation-config-property-value>
                        </activation-config-property>
                        <activation-config-property>
                            <activation-config-property-name>destination</activation-config-property-name>
                            <activation-config-property-value>jms/TradeStreamerTopic</activation-config-property-value>
                        </activation-config-property>
                        <activation-config-property>
                            <activation-config-property-name>acknowledgeMode</activation-config-property-name>
                            <activation-config-property-value>Auto-acknowledge</activation-config-property-value>
                        </activation-config-property>
                        <activation-config-property>
                            <activation-config-property-name>SubscriptionDurability</activation-config-property-name>
                            <activation-config-property-value>NonDurable</activation-config-property-value>
                        </activation-config-property>
                    </activation-config>
                </message-driven>

                <message-driven>
                    <ejb-name>TradeBrokerMDB</ejb-name>
                    <resource-adapter>
                        <!--<resource-link>TradeJMS</resource-link>-->
                        <resource-link>TradeJMSResources</resource-link>
                    </resource-adapter>
                    <activation-config>
                        <activation-config-property>
                            <activation-config-property-name>destinationType</activation-config-property-name>
                            <activation-config-property-value>javax.jms.Queue</activation-config-property-value>
                        </activation-config-property>
                        <activation-config-property>
                            <activation-config-property-name>destination</activation-config-property-name>
                            <activation-config-property-value>jms/TradeBrokerQueue</activation-config-property-value>
                        </activation-config-property>
                        <activation-config-property>
                            <activation-config-property-name>acknowledgeMode</activation-config-property-name>
                            <activation-config-property-value>Auto-acknowledge</activation-config-property-value>
                        </activation-config-property>
                        <activation-config-property>
                            <activation-config-property-name>SubscriptionDurability</activation-config-property-name>
                            <activation-config-property-value>NonDurable</activation-config-property-value>
                        </activation-config-property>
                    </activation-config>
                </message-driven>
            </enterprise-beans>

            <!--
            **
            ** R e l a t i o n s h i p s   D e f i n i t i o n s
            **
            **
            ** The following section defines the relationshoips for the entity beans in the application.
            -->
            <relationships>
                <ejb-relation>
                    <ejb-relation-name>Account-Orders</ejb-relation-name>
                    <ejb-relationship-role>
                        <ejb-relationship-role-name>AccountEJB</ejb-relationship-role-name>
                        <relationship-role-source>
                            <ejb-name>AccountEJB</ejb-name>
                        </relationship-role-source>
                        <cmr-field>
                            <cmr-field-name>orders</cmr-field-name>
                        </cmr-field>
                        <role-mapping>
                            <cmr-field-mapping>
                                <key-column>accountID</key-column>
                                <foreign-key-column>account_accountID</foreign-key-column>
                            </cmr-field-mapping>
                        </role-mapping>
                    </ejb-relationship-role>
                </ejb-relation>


                <!--
                **
                ** A c c o u n t   -   A c c o u n t P r o f i l e
                **
                **
                ** The following section defines the relationships for the entity beans in the application.
                -->
                <ejb-relation>
                    <ejb-relation-name>Account-AccountProfile</ejb-relation-name>
                    <ejb-relationship-role>
                        <ejb-relationship-role-name>Account-Has-AccountProfile</ejb-relationship-role-name>
                        <relationship-role-source>
                            <ejb-name>AccountEJB</ejb-name>
                        </relationship-role-source>
                        <cmr-field>
                            <cmr-field-name>profile</cmr-field-name>
                        </cmr-field>
                        <foreign-key-column-on-source/>
                        <role-mapping>
                            <cmr-field-mapping>
                                <key-column>userID</key-column>
                                <foreign-key-column>profile_userID</foreign-key-column>
                            </cmr-field-mapping>
                        </role-mapping>
                    </ejb-relationship-role>
                </ejb-relation>


                <!--
                **
                ** A c c o u n t   -   H o l d i n g s
                **
                **
                **
                -->
                <ejb-relation>
                    <ejb-relation-name>Account-Holdings</ejb-relation-name>
                    <ejb-relationship-role>
                        <ejb-relationship-role-name>AccountEJB</ejb-relationship-role-name>
                        <relationship-role-source>
                            <ejb-name>AccountEJB</ejb-name>
                        </relationship-role-source>
                        <cmr-field>
                            <cmr-field-name>holdings</cmr-field-name>
                        </cmr-field>
                        <role-mapping>
                            <cmr-field-mapping>
                                <key-column>accountID</key-column>
                                <foreign-key-column>account_accountID</foreign-key-column>
                            </cmr-field-mapping>
                        </role-mapping>
                    </ejb-relationship-role>
                </ejb-relation>


                <!--
                **
                ** Q u o t e  -  H o l d i n g s
                **
                **
                ** The following section defines the relationships for the entity beans in the application.
                -->
                <ejb-relation>
                    <ejb-relation-name>Quote-Holdings</ejb-relation-name>
                    <ejb-relationship-role>
                        <ejb-relationship-role-name>Holding-Has-Quote</ejb-relationship-role-name>
                        <relationship-role-source>
                            <ejb-name>HoldingEJB</ejb-name>
                        </relationship-role-source>
                        <cmr-field>
                            <cmr-field-name>quote</cmr-field-name>
                        </cmr-field>
                        <foreign-key-column-on-source/>
                        <role-mapping>
                            <cmr-field-mapping>
                                <key-column>symbol</key-column>
                                <foreign-key-column>quote_symbol</foreign-key-column>
                            </cmr-field-mapping>
                        </role-mapping>
                    </ejb-relationship-role>
                </ejb-relation>


                <!--
                **
                ** Q u o t e   -   O r d e r s
                **
                **
                ** The following section defines the relationships for the entity beans in the application.
                -->
                <ejb-relation>
                    <ejb-relation-name>Quote-Orders</ejb-relation-name>
                    <ejb-relationship-role>
                        <ejb-relationship-role-name>Order-Has-Quote</ejb-relationship-role-name>
                        <relationship-role-source>
                            <ejb-name>OrderEJB</ejb-name>
                        </relationship-role-source>
                        <cmr-field>
                            <cmr-field-name>quote</cmr-field-name>
                        </cmr-field>
                        <foreign-key-column-on-source/>
                        <role-mapping>
                            <cmr-field-mapping>
                                <key-column>symbol</key-column>
                                <foreign-key-column>quote_symbol</foreign-key-column>
                            </cmr-field-mapping>
                        </role-mapping>
                    </ejb-relationship-role>
                </ejb-relation>


                <!--
                **
                ** O r d e r  -   H o l d i n g
                **
                **
                ** The following section defines the relationships for the entity beans in the application.
                -->
                <ejb-relation>
                    <ejb-relation-name>Order-Holding</ejb-relation-name>
                    <ejb-relationship-role>
                        <ejb-relationship-role-name>Order-Has-Holding</ejb-relationship-role-name>
                        <relationship-role-source>
                            <ejb-name>OrderEJB</ejb-name>
                        </relationship-role-source>
                        <cmr-field>
                            <cmr-field-name>holding</cmr-field-name>
                        </cmr-field>
                        <foreign-key-column-on-source/>
                        <role-mapping>
                            <cmr-field-mapping>
                                <key-column>holdingID</key-column>
                                <foreign-key-column>holding_holdingID</foreign-key-column>
                            </cmr-field-mapping>
                        </role-mapping>
                    </ejb-relationship-role>
                </ejb-relation>
            </relationships>
            <persistence xmlns="http://java.sun.com/xml/ns/persistence" version="1.0">

                <persistence-unit name="daytrader">

                    <provider>org.apache.openjpa.persistence.PersistenceProviderImpl</provider>
                    <jta-data-source>jdbc/TradeDataSource</jta-data-source>
                    <non-jta-data-source>jdbc/NoTxTradeDataSource</non-jta-data-source>
                    <properties>
                        <property name="openjpa.jdbc.DBDictionary" value="org.apache.openjpa.jdbc.sql.DerbyDictionary"/>
                        <!-- property name="openjpa.jdbc.DBDictionary" value="org.apache.openjpa.jdbc.sql.DB2Dictionary"/ -->
                        <property name="openjpa.jdbc.SynchronizeMappings" value="buildSchema(ForeignKeys=true)"/>
                        <property name="openjpa.Sequence" value="table(Table=OPENJPASEQ, Increment=100)"/>
                    </properties>
                </persistence-unit>
            </persistence>

        </openejb-jar>
    </module>


    <module>
        <java>streamer.jar</java>
        <application-client xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-client-1.2">
            <client-environment xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2">
                <moduleId>
                    <groupId>org.apache.geronimo.daytrader</groupId>
                    <artifactId>daytrader-streamer-client</artifactId>
                    <version>2.0-SNAPSHOT</version>
                    <type>car</type>
                </moduleId>
            </client-environment>
            <server-environment xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2">
                <moduleId>
                    <groupId>org.apache.geronimo.daytrader</groupId>
                    <artifactId>daytrader-streamer-client-server</artifactId>
                    <version>2.0-SNAPSHOT</version>
                    <type>car</type>
                </moduleId>
            </server-environment>
            <resource>
                <external-rar xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2">
                    <dep:groupId>org.apache.geronimo.modules</dep:groupId>
                    <dep:artifactId>geronimo-activemq-ra</dep:artifactId>
                    <dep:type>rar</dep:type>
                </external-rar>
                <connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2">
                    <resourceadapter>
                        <resourceadapter-instance>
                            <resourceadapter-name>ActiveMQ RA</resourceadapter-name>
                            <config-property-setting name="ServerUrl">tcp://localhost:61616</config-property-setting>
                            <config-property-setting name="UserName">geronimo</config-property-setting>
                            <config-property-setting name="Password">geronimo</config-property-setting>
                            <workmanager>
                                <gbean-link>DefaultWorkManager</gbean-link>
                            </workmanager>
                        </resourceadapter-instance>
                        <outbound-resourceadapter>
                            <connection-definition>
                                <connectionfactory-interface>javax.jms.ConnectionFactory</connectionfactory-interface>
                                <connectiondefinition-instance>
                                    <name>jms/TopicConnectionFactory</name>
                                    <implemented-interface>javax.jms.QueueConnectionFactory</implemented-interface>
                                    <implemented-interface>javax.jms.TopicConnectionFactory</implemented-interface>
                                    <connectionmanager>
                                        <xa-transaction>
                                            <transaction-caching/>
                                        </xa-transaction>
                                        <single-pool>
                                            <max-size>10</max-size>
                                            <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds>
                                            <match-one/>
                                        </single-pool>
                                    </connectionmanager>
                                </connectiondefinition-instance>
                            </connection-definition>
                        </outbound-resourceadapter>
                    </resourceadapter>


                    <adminobject>
                        <adminobject-interface>javax.jms.Topic</adminobject-interface>
                        <adminobject-class>org.activemq.message.ActiveMQTopic</adminobject-class>
                        <adminobject-instance>
                            <message-destination-name>TradeStreamerTopic</message-destination-name>
                            <config-property-setting name="PhysicalName">TradeStreamerTopic</config-property-setting>
                        </adminobject-instance>
                    </adminobject>

                </connector>
            </resource>
        </application-client>
    </module>

    <module>
        <java>wsappclient.jar</java>
        <application-client xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-client-1.2">
            <client-environment xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2">
                <moduleId>
                    <groupId>org.apache.geronimo.daytrader</groupId>
                    <artifactId>daytrader-ws-client</artifactId>
                    <version>2.0-SNAPSHOT</version>
                    <type>car</type>
                </moduleId>
            </client-environment>
            <server-environment xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2">
                <moduleId>
                    <groupId>org.apache.geronimo.daytrader</groupId>
                    <artifactId>daytrader-ws-client-server</artifactId>
                    <version>2.0-SNAPSHOT</version>
                    <type>car</type>
                </moduleId>
            </server-environment>
        </application-client>
    </module>

    <ext-module>
        <connector>TradeDataSource</connector>
        <external-path xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2">
            <dep:groupId>org.tranql</dep:groupId>
            <dep:artifactId>tranql-connector-db2-embed-xa</dep:artifactId>
            <dep:type>rar</dep:type>
        </external-path>
        <connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2">


            <resourceadapter>
                <outbound-resourceadapter>
                    <connection-definition>
                        <connectionfactory-interface>javax.sql.DataSource</connectionfactory-interface>
                        <connectiondefinition-instance>
                            <name>jdbc/TradeDataSource</name>
                            <config-property-setting name="UserName">trade</config-property-setting>
                            <config-property-setting name="Password">trade</config-property-setting>
                            <config-property-setting name="PortNumber">50001</config-property-setting>
                            <config-property-setting name="ServerName">localhost</config-property-setting>
                            <config-property-setting name="DatabaseName">tradedb</config-property-setting>
                            <config-property-setting name="DriverType">4</config-property-setting>
                            <connectionmanager>
                                <xa-transaction>
                                    <transaction-caching/>
                                </xa-transaction>
                                <single-pool>
                                    <max-size>100</max-size>
                                    <min-size>0</min-size>
                                    <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds>
                                    <idle-timeout-minutes>30</idle-timeout-minutes>
                                    <match-one/>
                                </single-pool>
                            </connectionmanager>
                        </connectiondefinition-instance>
                    </connection-definition>
                </outbound-resourceadapter>
            </resourceadapter>
        </connector>
    </ext-module>


    <ext-module>
        <connector>TradeJMS</connector>
        <external-path xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2">
            <dep:groupId>org.apache.geronimo.modules</dep:groupId>
            <dep:artifactId>geronimo-activemq-ra</dep:artifactId>
            <dep:type>rar</dep:type>
        </external-path>
        <connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2">

            <resourceadapter>
                <!-- how to connect to the JMS Server -->
                <resourceadapter-instance>
                    <resourceadapter-name>TradeJMSResources</resourceadapter-name>
                    <config-property-setting name="ServerUrl">tcp://localhost:61616</config-property-setting>
                    <config-property-setting name="UserName">not needed</config-property-setting>
                    <config-property-setting name="Password">not needed</config-property-setting>
                    <workmanager>
                        <gbean-link>DefaultWorkManager</gbean-link>
                    </workmanager>
                </resourceadapter-instance>
                <!-- defines a ConnectionFactory -->
                <outbound-resourceadapter>
	                    <connection-definition>
                        <connectionfactory-interface>javax.jms.ConnectionFactory</connectionfactory-interface>
                        <connectiondefinition-instance>
                            <name>jms/QueueConnectionFactory</name>
                            <implemented-interface>javax.jms.QueueConnectionFactory</implemented-interface>
                            <connectionmanager>
                                <xa-transaction>
                                    <transaction-caching/>
                                </xa-transaction>
                                <single-pool>
                                    <max-size>50</max-size>
                                    <min-size>0</min-size>
                                    <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds>
                                    <idle-timeout-minutes>0</idle-timeout-minutes>
                                    <match-one/>
                                </single-pool>
                            </connectionmanager>
                        </connectiondefinition-instance>
                    </connection-definition>
                    <connection-definition>
                        <connectionfactory-interface>javax.jms.ConnectionFactory</connectionfactory-interface>
                        <connectiondefinition-instance>
                            <name>jms/TopicConnectionFactory</name>
                            <implemented-interface>javax.jms.TopicConnectionFactory</implemented-interface>
                            <connectionmanager>
                                <xa-transaction>
                                    <transaction-caching/>
                                </xa-transaction>
                                <single-pool>
                                    <max-size>50</max-size>
                                    <min-size>0</min-size>
                                    <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds>
                                    <idle-timeout-minutes>0</idle-timeout-minutes>
                                    <match-one/>
                                </single-pool>
                            </connectionmanager>
                        </connectiondefinition-instance>
                    </connection-definition>
                </outbound-resourceadapter>
            </resourceadapter>

            <adminobject>
                <adminobject-interface>javax.jms.Topic</adminobject-interface>
                <adminobject-class>org.activemq.message.ActiveMQTopic</adminobject-class>
                <adminobject-instance>
                    <message-destination-name>jms/TradeStreamerTopic</message-destination-name>
                    <config-property-setting name="PhysicalName">TradeStreamerTopic</config-property-setting>
                </adminobject-instance>
            </adminobject>

            <adminobject>
                <adminobject-interface>javax.jms.Queue</adminobject-interface>
                <adminobject-class>org.activemq.message.ActiveMQQueue</adminobject-class>
                <adminobject-instance>
                    <message-destination-name>jms/TradeBrokerQueue</message-destination-name>
                    <config-property-setting name="PhysicalName">TradeBrokerQueue</config-property-setting>
                </adminobject-instance>
            </adminobject>

        </connector>
    </ext-module>
</application>
